#!/bin/sh

nofile () \
{
    echo -n "no "
    n=false
    for j in $m;do
      if $n;then echo -n " or ";else n=true;fi
      echo -n $j
    done
    echo " in $1"
    echo
}
found=false;
use_tar=false
for k in tar tar.gz tgz tar.bz2 tbz tar.xz txz;do
  i=$(basename $1 .$k)
  if [ $i != $1 ];then
    use_tar=true
    break
  fi
done
$use_tar ||
{
  i=$(basename $1 .zip)
  if [ $i != $1 ];then use_zip=true;else use_zip=false;fi
}
# Most common first
m="./$i/README \
$i/README \
$i/README.$i \
./$i/README.$i \
$i/README.txt \
$i/README.TXT \
readme.txt"
if $use_tar;then  # Always exits
  for j in $m;do
    if tar -tf $1 $j >/dev/null 2>&1;then
      found=true
      break
    fi
  done
  if $found;then
    tar -xOf $1 $j
    exit
  else
    nofile $1
    tar -tf $1
    exit 1
  fi
fi
if $use_zip;then
  for j in $m;do
    if unzip -t $1 $j >/dev/null 2>&1;then
      found=true
      break
    fi
  done
  if $found;then
    unzip -p $1 $j
  else
    nofile $1
    unzip -l $1
    exit 1
  fi
  exit
fi
echo $1 not a recognised format
exit 1
